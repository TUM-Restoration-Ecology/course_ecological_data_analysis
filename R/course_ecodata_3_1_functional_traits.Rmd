---
title: "Analysis of ecological data: <br> 3.1 How to get traits?"
author: "<b>Markus Bauer</b> <br>"
date: "<b>`r format(Sys.time(), '%Y-%m-%d')`</b>"
output:
  github_document:
    toc: true
    toc_depth: 3
    dev: png
    fig_width: 7
    fig_height: 5
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE
  )
```

<br/> <br/> <b>Markus Bauer</b>

Technichal University of Munich, TUM School of Life Sciences, Chair of
Restoration Ecology, Emil-Ramann-Straße 6, 85354 Freising, Germany

[markus1.bauer\@tum.de](mailto:markus1.bauer@tum.de)

ORCiD ID: [0000-0001-5372-4174](https://orcid.org/0000-0001-5372-4174)
<br> [Google
Scholar](https://scholar.google.de/citations?user=oHhmOkkAAAAJ&hl=de&oi=ao)
<br> GitHub: [markus1bauer](https://github.com/markus1bauer)

# 1 Preparation

Load libraries. You can always install missing libraries by
`install.packages("GIFT")` for the GIFT package.

```{r libraries, message = FALSE}
library(here)
library(tidyverse)
library(GIFT)
library(TNRS)
rm(list = ls())
```

Load the example dataset of alluvial forests along river Ammer.

The location is in the Ammer valley before and after the weir.
<https://www.openstreetmap.org/#map=16/47.7737/10.9615>

Normally there are alluvial grey alder forests (Alnetum incanae,
alliance Alnion incanae, EUNIS habitat T12)
<https://floraveg.eu/vegetation/overview/Alnion%20incanae>
<https://floraveg.eu/habitat/overview/T12>

Due to the dam along the Ammer and the weir in the Ammer the flood
regime changed and the vegetation could have developed to a maple-ash
forest ('Edellaubholzwald') (Adoxo-Aceretum, alliance Tilio-Acerion,
EUNIS habitat type T1F)
<https://floraveg.eu/vegetation/overview/Tilio-Acerion>
<https://floraveg.eu/habitat/overview/T1F>

```{r load-data}
species <- read_csv(
  here("data", "raw", "example_course_alluvial_forest_mb", "data_raw_species.csv"),
  col_names = TRUE, col_types = cols(
    .default = "?",
    name = "f",
    layer = "f"
    )
  ) %>%
  select(-contains("Extra")) %>% # exclude some plots
  filter(layer == "h") %>% # filter only species of the herbal layer
  group_by(name) %>%
  mutate(
    sum = sum(c_across(IN1:AC6)),
    presence = if_else(sum > 0, 1, 0)
    ) %>%
  filter(presence == 1) %>% # exclude species which are not present in the remaining plots
  ungroup() %>%
  select(-sum, -presence, -layer)

traits <- read_csv(
  here("data", "raw", "example_course_alluvial_forest_mb", "data_raw_traits.csv"),
  col_names = TRUE, col_types = cols(.default = "?")
  ) %>%
  select(name, lifeform) %>%
  filter(!str_detect(lifeform, "wood"))

species <- species %>%
  semi_join(traits, by = "name") # only herbal species
traits <- traits %>%
  semi_join(species, by = "name") # only species which occur in the plots


```

# 2 Metadata of plant traits of GIFT

There are many functional traits available in GIFT. Each of these traits
has an identification number called `trait_ID`. Since the two functions
for retrieving trait values, `GIFT_traits()` and `GIFT_traits_raw()`,
rely on these IDs, the first step is to call the function
`GIFT_traits_meta()` to know what the ID of the desired trait is. For
example, let’s say we want to retrieve the maximum vegetative heights of
plant species.

```{r select-plant-traits}
trait_meta <- GIFT_traits_meta() %>% as_tibble()
trait_meta %>%
  filter(str_detect(Trait2, "height"))
```

We can see that the ID of this trait is 1.6.2. Now that we have the ID,
we can use `GIFT_traits()` to retrieve the growth form values for
different plant species.

| Search the IDs of specific leaf area (SLA) and seed mass.

| Note the categories, IDs and unit for the material-and-methods section.

# 3 Use TNRS for name resolving

```{r}

```

# 4 Download trait values

## 4.1 Species level

```{r}

```

## 4.2 Taxonomic level

```{r}

```

# 5 Merge your dataset with GIFT traits

## 5.1 Merge dataset

```{r}

```

## 5.1 Check completeness

```{r}

```

# 6 Save your traits table

```{r}

```
