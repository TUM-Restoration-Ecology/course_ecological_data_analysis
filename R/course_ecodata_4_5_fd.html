<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.554">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Markus Bauer  ">
<meta name="dcterms.date" content="2024-09-22">

<title>Analysis of Ecological Data   Functional Diversity (FD) within communities</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="course_ecodata_4_5_fd_files/libs/clipboard/clipboard.min.js"></script>
<script src="course_ecodata_4_5_fd_files/libs/quarto-html/quarto.js"></script>
<script src="course_ecodata_4_5_fd_files/libs/quarto-html/popper.min.js"></script>
<script src="course_ecodata_4_5_fd_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="course_ecodata_4_5_fd_files/libs/quarto-html/anchor.min.js"></script>
<link href="course_ecodata_4_5_fd_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="course_ecodata_4_5_fd_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="course_ecodata_4_5_fd_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="course_ecodata_4_5_fd_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="course_ecodata_4_5_fd_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="2">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#preparation" id="toc-preparation" class="nav-link active" data-scroll-target="#preparation"><span class="header-section-number">1</span> Preparation</a>
  <ul class="collapse">
  <li><a href="#load-libraries-and-functions" id="toc-load-libraries-and-functions" class="nav-link" data-scroll-target="#load-libraries-and-functions"><span class="header-section-number">1.1</span> Load libraries and functions</a></li>
  <li><a href="#load-data" id="toc-load-data" class="nav-link" data-scroll-target="#load-data"><span class="header-section-number">1.2</span> Load data</a></li>
  </ul></li>
  <li><a href="#calculation-of-fd" id="toc-calculation-of-fd" class="nav-link" data-scroll-target="#calculation-of-fd"><span class="header-section-number">2</span> Calculation of FD</a>
  <ul class="collapse">
  <li><a href="#calculation-with-the-dbfd-function" id="toc-calculation-with-the-dbfd-function" class="nav-link" data-scroll-target="#calculation-with-the-dbfd-function"><span class="header-section-number">2.1</span> Calculation with the dbFD function</a>
  <ul class="collapse">
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction"><span class="header-section-number">2.1.1</span> Introduction</a></li>
  <li><a href="#w-argument" id="toc-w-argument" class="nav-link" data-scroll-target="#w-argument"><span class="header-section-number">2.1.2</span> w argument</a></li>
  </ul></li>
  <li><a href="#spain-data" id="toc-spain-data" class="nav-link" data-scroll-target="#spain-data"><span class="header-section-number">2.2</span> Spain data</a>
  <ul class="collapse">
  <li><a href="#numeric-traits" id="toc-numeric-traits" class="nav-link" data-scroll-target="#numeric-traits"><span class="header-section-number">2.2.1</span> Numeric traits</a></li>
  <li><a href="#fd-with-fuzzy-coding" id="toc-fd-with-fuzzy-coding" class="nav-link" data-scroll-target="#fd-with-fuzzy-coding"><span class="header-section-number">2.2.2</span> FD with fuzzy coding</a></li>
  <li><a href="#saving" id="toc-saving" class="nav-link" data-scroll-target="#saving"><span class="header-section-number">2.2.3</span> Saving</a></li>
  <li><a href="#plotting" id="toc-plotting" class="nav-link" data-scroll-target="#plotting"><span class="header-section-number">2.2.4</span> Plotting</a></li>
  </ul></li>
  <li><a href="#ammer-data" id="toc-ammer-data" class="nav-link" data-scroll-target="#ammer-data"><span class="header-section-number">2.3</span> Ammer data</a>
  <ul class="collapse">
  <li><a href="#preparation-1" id="toc-preparation-1" class="nav-link" data-scroll-target="#preparation-1"><span class="header-section-number">2.3.1</span> Preparation</a></li>
  <li><a href="#calculation" id="toc-calculation" class="nav-link" data-scroll-target="#calculation"><span class="header-section-number">2.3.2</span> Calculation</a></li>
  <li><a href="#saving-1" id="toc-saving-1" class="nav-link" data-scroll-target="#saving-1"><span class="header-section-number">2.3.3</span> Saving</a></li>
  <li><a href="#plotting-1" id="toc-plotting-1" class="nav-link" data-scroll-target="#plotting-1"><span class="header-section-number">2.3.4</span> Plotting</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Analysis of Ecological Data <br> Functional Diversity (FD) within communities</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p><b>Markus Bauer</b> <br> </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">2024-09-22</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>Technichal University of Munich, TUM School of Life Sciences, Chair of Restoration Ecology, Emil-Ramann-Straße 6, 85354 Freising, Germany</p>
<p><a href="mailto:markus1.bauer@tum.de">markus1.bauer@tum.de</a></p>
<p><img src="https://info.orcid.org/wp-content/uploads/2019/11/orcid_16x16.png" alt="ORCID logo" width="20" height="20"><a href="https://orcid.org/0000-0001-5372-4174" class="uri">https://orcid.org/0000-0001-5372-4174</a></p>
<p><a href="https://scholar.google.de/citations?user=oHhmOkkAAAAJ&amp;hl=de&amp;oi=ao"><img src="https://img.shields.io/badge/Google%20Scholar-4285F4?style=for-the-badge&amp;logo=google-scholar&amp;logoColor=white.png" class="img-fluid" alt="Google Scholar"></a> <a href="https://github.com/markus1bauer"><img src="https://img.shields.io/badge/github-%23121011.svg?style=for-the-badge&amp;logo=github&amp;logoColor=white" class="img-fluid" alt="GitHub"></a></p>
<p>This tutorial uses Bello et al.&nbsp;(<a href="https://doi.org/10.1017/9781108628426">2021</a>)</p>
<section id="preparation" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Preparation</h1>
<p>In this exercise we will learn how to compute different indices of Functional diversity (FD). This exercise follows the second part of Chapter 5 of the reference textbook, so all theoretical and mathematical issues beyond the indices described in this exercise can be found there. We will work with invented data and also field data from an climatic gradient in NE Spain. In Chapter 3, and the relative exercise, we already explained how to compute trait dissimilarity between species pairs, and thus in this exercise we assume that users have already an idea how to compute and interpret such trait dissimilarity. This file will first cover the use of the <code>dbFD</code> function, with invented data and then with the NE Spain data. Finally, we will learn how to compute alpha, beta and gamma functional diversity with the Rao index.</p>
<section id="load-libraries-and-functions" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="load-libraries-and-functions"><span class="header-section-number">1.1</span> Load libraries and functions</h2>
<p>The FD package is of Laliberté &amp; Legendre (<a href="https://doi.org/10.1890/08-2244.1">2010</a>)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(FD)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(funspace)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will also need one ad-hoc function ‘Rao’</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"raw"</span>, <span class="st">"bello_etal-2021"</span>,  <span class="st">"chapter5"</span>, <span class="st">"Rao.r"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-data" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="load-data"><span class="header-section-number">1.2</span> Load data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>species_spain <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  here<span class="sc">::</span><span class="fu">here</span>(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"data"</span>, <span class="st">"raw"</span>, <span class="st">"bello_etal-2021"</span>, <span class="st">"chapter5"</span>, <span class="st">"speciesXplotsNE.txt"</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_names =</span> <span class="cn">TRUE</span>, <span class="at">delim =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">col_types =</span> <span class="fu">cols</span>(<span class="at">.default =</span> <span class="st">"?"</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="st">"species"</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>traits_spain <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  here<span class="sc">::</span><span class="fu">here</span>(</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"data"</span>, <span class="st">"raw"</span>, <span class="st">"bello_etal-2021"</span>, <span class="st">"chapter5"</span>, <span class="st">"speciesXtraitsNE.txt"</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_names =</span> <span class="cn">TRUE</span>, <span class="at">delim =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">col_types =</span> <span class="fu">cols</span>(<span class="at">.default =</span> <span class="st">"?"</span>)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="st">"species"</span>)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>sites_spain <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"processed"</span>, <span class="st">"data_processed_sites_spain_4.4.csv"</span>),</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_names =</span> <span class="cn">TRUE</span>, <span class="at">col_types =</span> <span class="fu">cols</span>(<span class="at">.default =</span> <span class="st">"?"</span>)</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>species_ammer <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"processed"</span>, <span class="st">"data_processed_species_ammer_4.1.csv"</span>),</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_names =</span> <span class="cn">TRUE</span>, <span class="at">col_types =</span> <span class="fu">cols</span>(<span class="at">.default =</span> <span class="st">"?"</span>)</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>traits_ammer <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>  here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"processed"</span>, <span class="st">"data_processed_traits_ammer_4.1.csv"</span>),</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_names =</span> <span class="cn">TRUE</span>, <span class="at">col_types =</span> <span class="fu">cols</span>(<span class="at">.default =</span> <span class="st">"?"</span>)</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>sites_ammer <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>  here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"processed"</span>, <span class="st">"data_processed_sites_ammer_4.4.csv"</span>),</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_names =</span> <span class="cn">TRUE</span>, <span class="at">col_types =</span> <span class="fu">cols</span>(<span class="at">.default =</span> <span class="st">"?"</span>)</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><a href="#top">Back to top</a></p>
</section>
</section>
<section id="calculation-of-fd" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Calculation of FD</h1>
<section id="calculation-with-the-dbfd-function" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="calculation-with-the-dbfd-function"><span class="header-section-number">2.1</span> Calculation with the dbFD function</h2>
<section id="introduction" class="level3" data-number="2.1.1">
<h3 data-number="2.1.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">2.1.1</span> Introduction</h3>
<p>As well summarized in the help function of <code>?dbFD</code>, dbFD implements a flexible distance-based framework to compute multidimensional functional diversity (FD) indices. dbFD returns the three FD indices of Villéger et al.&nbsp;(<a href="https://doi.org/10.1890/07-1206.1">2008</a>): functional richness (FRic), functional evenness (FEve), and functional divergence (FDiv), as well as functional dispersion (FDis; Laliberté and Legendre <a href="https://doi.org/10.1890/08-2244.1">2010</a>), Rao’s quadratic entropy (Q) (Botta-Dukát <a href="https://doi.org/10.1111/j.1654-1103.2005.tb02393.x">2005</a>), a functional group richness (FGR) (number of functional groups, see Chapter 3 and Reference material Ch3 and Petchey and Gaston, <a href="https://doi.org/10.1111/j.1461-0248.2006.00924.x">2006</a>), and the community-level weighted means of trait values (CWM; e.g.&nbsp;Lavorel et al.&nbsp;<a href="https://doi.org/10.1111/j.1365-2435.2007.01339.x">2008</a>). Some of these FD indices consider species abundances (see Fig. 5.4 in the reference book).</p>
<p>As we just saw, the function <code>dbFD</code> is very practical because it computes a lot of indices of FD at once. Most of these indices are introduced and discussed in the reference textbook, in Chapter 5. We will thus learn how to apply the function <code>dbFD</code>, using first some of the examples available in the help of the function, i.e.&nbsp;from <code>?dbFD</code>. As in the exercises with CWM, the examples for the function consider invented data, the ‘dummy’ data, containing both a ‘species x community’ matrix and a ‘species x trait’ matrix.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>dummy <span class="ot">&lt;-</span> dummy</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>dummy<span class="sc">$</span>abun <span class="co"># Species x community matrix</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      sp1 sp2 sp3 sp4 sp5 sp6 sp7 sp8
com1    1   1   0   0   4   2   0   0
com2    0   0   0   2   1   0   0   5
com3    2   0   0   0   0   1   0   3
com4    1   0   7   0   0   0   0   0
com5    0   0   2   3   3   0   0   0
com6    0   3   0   0   5   6   1   6
com7    3   5   0   3   0   0   0   0
com8    0   0   0   0   6   2   1   2
com9    4   1   1   3   0   0   2   0
com10   0   4   1   0   0   0   6   1</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>dummy<span class="sc">$</span>trait <span class="co"># Species x trait matrix</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    num1 num2 fac1 fac2 ord1 ord2 bin1 bin2
sp1  9.0  4.5    A    X    3    2    0    1
sp2  8.1  6.0    A    Z &lt;NA&gt;    1    0    1
sp3   NA  2.3    C    Y    5    3    1    1
sp4  3.2  5.4    B    Z    1    7    0    0
sp5  5.8  1.2    C    X    2    6   NA    0
sp6  3.4  8.5    C    Y    2    1    1    1
sp7  7.5  2.1    B    X    3    2    1    0
sp8  4.3  6.5 &lt;NA&gt;    Z    1    3    0    1</code></pre>
</div>
</div>
<p><em>Notice</em> that the function <code>dbFD</code>, while extremely useful, has also many strict requirements. The species x community matrix should be a data frame and the order and name of species should be <em>exactly</em> the same in the ‘species x community matrix’ and in the Species x trait matrix.</p>
<p>It is very important to check that the species that you have in these ‘species x community’ matrix and ‘species x trait’ matrices should be the same. In this case we know that they are the same, so we can already run the code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>ex1 <span class="ot">&lt;-</span> <span class="fu">dbFD</span>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  dummy<span class="sc">$</span>trait, dummy<span class="sc">$</span>abun,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">w.abun =</span> <span class="cn">TRUE</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">calc.CWM =</span> <span class="cn">FALSE</span>, <span class="at">calc.FDiv =</span> <span class="cn">FALSE</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Species x species distance matrix was not Euclidean. 'sqrt' correction was applied. 
FEVe: Could not be calculated for communities with &lt;3 functionally singular species. 
FRic: To respect s &gt; t, FRic could not be calculated for communities with &lt;3 functionally singular species. 
FRic: Dimensionality reduction was required. The last 5 PCoA axes (out of 7 in total) were removed. 
FRic: Quality of the reduced-space representation (based on corrected distance matrix) = 0.6108352 </code></pre>
</div>
</div>
<p>First we see that the function is very “talkative”, i.e.&nbsp;it explains a lot of things while running. We can eventually switch-off the messages by using <code>messages = F</code>, as we will do in the next examples. In the meantime we can see that FEve (functional evenness) cannot be computed in communities with less than 3 species. Similarly as FRic (functional richness) and FDiv (functional divergence) cannot be computed if there is less that 3 unique species, meaning that they should at least have one different trait value. Other important messages include the number of PCoA axes considered. Out of the 7 considered (i.e.&nbsp;with 8 species, the number of PCoA is 7) a total of 2 axes are retained to reflect trait differences between species (see Chapter 3 in the reference book and R material Ch 3. In other words the PCoA has synthesized all traits into two multivariate axes.</p>
<p>Let’s now see the results. The results are stored in the object ex1, which is a ‘list’. As such if you need a particular object you can extract it, for example as <code>ex1$FRic</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(ex1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "list"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>ex1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$nbsp
 com1  com2  com3  com4  com5  com6  com7  com8  com9 com10 
    4     3     3     2     3     5     3     4     5     4 

$sing.sp
 com1  com2  com3  com4  com5  com6  com7  com8  com9 com10 
    4     3     3     2     3     5     3     4     5     4 

$FRic
       com1        com2        com3        com4        com5        com6 
0.174201349 0.102097174 0.002157642          NA 0.143151204 0.231083703 
       com7        com8        com9       com10 
0.073683375 0.174220613 0.337446205 0.228904118 

$qual.FRic
[1] 0.6108352

$FEve
     com1      com2      com3      com4      com5      com6      com7      com8 
0.8432334 0.4628635 0.8659657        NA 0.9081209 0.8651734 0.7681991 0.7606650 
     com9     com10 
0.7994638 0.4944601 

$FDis
     com1      com2      com3      com4      com5      com6      com7      com8 
0.3481687 0.1670560 0.2375808 0.1146261 0.3211366 0.3302330 0.2532751 0.2877931 
     com9     com10 
0.3421687 0.3503927 

$RaoQ
      com1       com2       com3       com4       com5       com6       com7 
0.12835440 0.04063622 0.06497224 0.03003235 0.11858388 0.11738479 0.07868047 
      com8       com9      com10 
0.09308505 0.12431265 0.12490783 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>ex1<span class="sc">$</span>FRic</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       com1        com2        com3        com4        com5        com6 
0.174201349 0.102097174 0.002157642          NA 0.143151204 0.231083703 
       com7        com8        com9       com10 
0.073683375 0.174220613 0.337446205 0.228904118 </code></pre>
</div>
</div>
<p>For categorical and binary traits you might want to include the argument <code>CWM.type = "all"</code> when running it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>ex1 <span class="ot">&lt;-</span> <span class="fu">dbFD</span>(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  dummy<span class="sc">$</span>trait, dummy<span class="sc">$</span>abun, <span class="at">CWM.type =</span> <span class="st">"all"</span>, <span class="at">message =</span> <span class="cn">FALSE</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># notice we add `message = F` to avoid too many annoying messages from the function :)</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>ex1<span class="sc">$</span>CWM</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          num1     num2    fac1_A     fac1_B     fac1_C    fac2_X     fac2_Y
com1  5.887500 4.037500 0.2500000 0.00000000 0.75000000 0.6250000 0.25000000
com2  4.212500 5.562500 0.0000000 0.25000000 0.12500000 0.1250000 0.00000000
com3  5.716667 6.166667 0.3333333 0.00000000 0.16666667 0.3333333 0.16666667
com4  9.000000 2.575000 0.1250000 0.00000000 0.87500000 0.1250000 0.87500000
com5  4.500000 3.050000 0.0000000 0.37500000 0.62500000 0.3750000 0.25000000
com6  5.095238 5.528571 0.1428571 0.04761905 0.52380952 0.2857143 0.28571429
com7  7.009091 5.427273 0.7272727 0.27272727 0.00000000 0.2727273 0.00000000
com8  5.245455 3.572727 0.0000000 0.09090909 0.72727273 0.6363636 0.18181818
com9  6.870000 4.245455 0.4545455 0.45454545 0.09090909 0.5454545 0.09090909
com10 7.427273 3.783333 0.3333333 0.50000000 0.08333333 0.5000000 0.08333333
         fac2_Z     ord1_1    ord1_2     ord1_3     ord1_5     ord2_1
com1  0.1250000 0.00000000 0.7500000 0.12500000 0.00000000 0.37500000
com2  0.8750000 0.87500000 0.1250000 0.00000000 0.00000000 0.00000000
com3  0.5000000 0.50000000 0.1666667 0.33333333 0.00000000 0.16666667
com4  0.0000000 0.00000000 0.0000000 0.12500000 0.87500000 0.00000000
com5  0.3750000 0.37500000 0.3750000 0.00000000 0.25000000 0.00000000
com6  0.4285714 0.28571429 0.5238095 0.04761905 0.00000000 0.42857143
com7  0.7272727 0.27272727 0.0000000 0.27272727 0.00000000 0.45454545
com8  0.1818182 0.18181818 0.7272727 0.09090909 0.00000000 0.18181818
com9  0.3636364 0.27272727 0.0000000 0.54545455 0.09090909 0.09090909
com10 0.4166667 0.08333333 0.0000000 0.50000000 0.08333333 0.33333333
          ord2_2     ord2_3    ord2_6    ord2_7    bin1_0    bin1_1    bin2_0
com1  0.12500000 0.00000000 0.5000000 0.0000000 0.2500000 0.2500000 0.5000000
com2  0.00000000 0.62500000 0.1250000 0.2500000 0.8750000 0.0000000 0.3750000
com3  0.33333333 0.50000000 0.0000000 0.0000000 0.8333333 0.1666667 0.0000000
com4  0.12500000 0.87500000 0.0000000 0.0000000 0.1250000 0.8750000 0.0000000
com5  0.00000000 0.25000000 0.3750000 0.3750000 0.3750000 0.2500000 0.7500000
com6  0.04761905 0.28571429 0.2380952 0.0000000 0.4285714 0.3333333 0.2857143
com7  0.27272727 0.00000000 0.0000000 0.2727273 1.0000000 0.0000000 0.2727273
com8  0.09090909 0.18181818 0.5454545 0.0000000 0.1818182 0.2727273 0.6363636
com9  0.54545455 0.09090909 0.0000000 0.2727273 0.7272727 0.2727273 0.4545455
com10 0.50000000 0.16666667 0.0000000 0.0000000 0.4166667 0.5833333 0.5000000
         bin2_1
com1  0.5000000
com2  0.6250000
com3  1.0000000
com4  1.0000000
com5  0.2500000
com6  0.7142857
com7  0.7272727
com8  0.3636364
com9  0.5454545
com10 0.5000000</code></pre>
</div>
</div>
</section>
<section id="w-argument" class="level3" data-number="2.1.2">
<h3 data-number="2.1.2" class="anchored" data-anchor-id="w-argument"><span class="header-section-number">2.1.2</span> w argument</h3>
<p>In the second example of the help page for <code>dbFD</code>, it is possible to see a the argument <code>w</code>, which was discussed for the <code>gowdis</code> in the R material Ch3 and in Chapter 3 of the reference textbook. As a matter of fact the function gowdis is also included in the <code>dbFD</code> function and, although you do not see it, it is applied exactly as already introduced in the R material 3. This is the first step for the calculation of functional diversity.</p>
<p>The argument <code>w</code> allows us to give different weights to the traits, for example when you want some traits to be more important in the calculation of the dissimilarity between species and thus functional diversity (we discuss the importance of this weight in the exercises related to Chapter 3). The example 2 in the help function looks like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add variable weights</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">2</span>, <span class="dv">6</span>, <span class="dv">1</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>ex2 <span class="ot">&lt;-</span> <span class="fu">dbFD</span>(</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  dummy<span class="sc">$</span>trait, dummy<span class="sc">$</span>abun, w, <span class="at">corr =</span> <span class="st">"cailliez"</span>, <span class="at">message =</span> <span class="cn">FALSE</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co"># `cailliez` correction is used because `sqrt` does not work</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In practice the second trait got 5 times more weight than the first one (the vector w, includes one value for each trait, reflecting the intended weight in the calculation; again see R material Ch 2.</p>
<p>It might happen that when running the dbFD function you get some sort of errors. For example if you run a line such as <code>ex2 &lt;- dbFD(dummy$trait, dummy$abun, w, message = F)</code>, you will get one saying that the distance between species did not have Euclidean properties after the square root correction, which is automatically applied in the function. The PCoA analyses work better when the dissimilarity matrix (differences between species in terms of traits; R material Ch 2) has Euclidean properties and the dbFD function will not work unless this condition is met. In the case that the function does not work directly with your data, you can try other corrections with the argument corr. The help function provides enough information on this issue. In practice the effect of such correction is not very strong, at least in our experience, especially when there are enough species.</p>
<p>It is very important to notice that the function <code>dbFD</code> works not only by providing a ‘species x trait’ matrix like the <code>dummy$trait</code> in the example above. You can also provide directly a distance matrix calculated before hand, for example using the Gower distance (see Chapter 3; R material Ch 3). If you run the following example (ex3) you will thus get the same results as in the object ex1.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>trait.d <span class="ot">&lt;-</span> <span class="fu">gowdis</span>(dummy<span class="sc">$</span>trait) <span class="co"># Gower distance</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>ex3 <span class="ot">&lt;-</span> <span class="fu">dbFD</span>(trait.d, dummy<span class="sc">$</span>abun, <span class="at">message =</span> <span class="cn">FALSE</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>ex1<span class="sc">$</span>FRic <span class="sc">==</span> ex3<span class="sc">$</span>FRic</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> com1  com2  com3  com4  com5  com6  com7  com8  com9 com10 
 TRUE  TRUE  TRUE    NA  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE </code></pre>
</div>
</div>
<p>Similarly if you apply <code>w</code> in the calculation of the Gower distance:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>trait.dw <span class="ot">&lt;-</span> <span class="fu">gowdis</span>(dummy<span class="sc">$</span>trait, w) <span class="co"># Gower distance with a different weight for the traits</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>ex3w <span class="ot">&lt;-</span> <span class="fu">dbFD</span>(</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  trait.dw, dummy<span class="sc">$</span>abun, <span class="at">corr =</span> <span class="st">"cailliez"</span>, <span class="at">message =</span> <span class="cn">FALSE</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>ex2<span class="sc">$</span>FRic <span class="sc">==</span> ex3w<span class="sc">$</span>FRic</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> com1  com2  com3  com4  com5  com6  com7  com8  com9 com10 
 TRUE  TRUE  TRUE    NA  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE </code></pre>
</div>
</div>
<p>Although we already discussed what is a dissimilarity matrix in Chapter 3, and its corresponding R material Ch 3, in the next lines, we show once again how it does look:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>trait.d <span class="co"># Gower distance</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          sp1       sp2       sp3       sp4       sp5       sp6       sp7
sp2 0.2181884                                                            
sp3 0.5240052 0.6678082                                                  
sp4 0.6737443 0.5610028 0.8225701                                        
sp5 0.5291113 0.8145699 0.4862253 0.4843264                              
sp6 0.6100161 0.5932587 0.2784736 0.7073925 0.6067323                    
sp7 0.4484235 0.6863374 0.4848663 0.5575126 0.3023416 0.6187844          
sp8 0.4072834 0.2039443 0.5958904 0.2390962 0.5585525 0.4470207 0.7030186</code></pre>
</div>
</div>
<p>In practice, this object shows the functional distance, i.e.&nbsp;dissimilarity between each pair of species, in this case expressed as an average dissimilarity over all (standardized) traits.</p>
<p>The function <code>dbFD</code> applies the Gower distance automatically if you use a species x trait matrix (such as ‘spxt’). It will also work when proving a dissimilarity matrix, unless such dissimilarity does not contain any NAs (NAs in the dissimilarity matrix are not accepted!). This means that you can either provide a specific dissimilarity matrix after checking that there are no NAs or you can make sure that, in the ‘species x trait’ matrix, you have ‘enough’ trait values. In other words, this means that species pairs should have, at least, information for one common trait.</p>
<p><a href="#top">Back to top</a></p>
</section>
</section>
<section id="spain-data" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="spain-data"><span class="header-section-number">2.2</span> Spain data</h2>
<section id="numeric-traits" class="level3" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="numeric-traits"><span class="header-section-number">2.2.1</span> Numeric traits</h3>
<p>Let’s now apply the <code>dbFD</code> function to the NE Spain data already described in section 5.1 above. The data was already loaded already above. As in the exercise on CWM, we need to improve the normality of the trait SLA in the matrix.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">setdiff</span>(<span class="fu">ls</span>(), <span class="fu">c</span>(<span class="st">"species_ammer"</span>, <span class="st">"species_spain"</span>, <span class="st">"traits_ammer"</span>, <span class="st">"traits_spain"</span>, <span class="st">"sites_spain"</span>, <span class="st">"sites_ammer"</span>)))</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>traits_spain <span class="ot">&lt;-</span> traits_spain <span class="sc">%&gt;%</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SLA =</span> <span class="fu">log</span>(SLA)) <span class="co">#improve the normality of the trait values</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(traits_spain)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         GrowhtForm LEG      SLA LF_Th LF_G LF_H LF_hCh LF_wCh LF_NP LF_P
Acercamp      shrub   0 2.753661     0    0  0.0    0.0      0     0    1
Achimill       forb   0 2.681022     0    0  0.5    0.5      0     0    0
Aegigeni      grass   0 2.721295     1    0  0.0    0.0      0     0    0
Alchhybr       forb   0 2.944439     0    0  1.0    0.0      0     0    0
Anemhepa       forb   0 2.557227     0    0  1.0    0.0      0     0    0
Anthmont       forb   1 2.602690     0    0  1.0    0.0      0     0    0</code></pre>
</div>
</div>
<p>Let’s directly use the <code>dbFD</code> function. We need first to recall that we have a fuzzy coding data in the trait matrix (<code>spxt$LF_xx</code>) and for now, for simplicity, let’s forget about this type of trait data. We can use thus only the first 3 columns of the trait matrix for the time being (but see below for using all traits). Now that we know how the <code>dbFD</code> function works, i.e.&nbsp;it is used very similarly to the function <code>functcomp</code>, it is easy to have a lot of indices of FD computed in only one line! But for the time being we avoid computing again the CWM values, with the argument <code>calc.CWM = FALSE</code> and we also ask that the FRic will be standardized between 0 and 1, i.e.&nbsp;<code>stand.FRic = TRUE</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>resFD <span class="ot">&lt;-</span> <span class="fu">dbFD</span>(</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  traits_spain[, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="fu">log</span>(<span class="fu">t</span>(species_spain) <span class="sc">+</span> <span class="dv">1</span>), <span class="at">w.abun =</span> <span class="cn">TRUE</span>,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">message =</span> <span class="cn">FALSE</span>, <span class="at">calc.CWM =</span> <span class="cn">FALSE</span>, <span class="at">stand.FRic =</span> <span class="cn">TRUE</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in is.euclid(x.dist): Zero distance(s)
Warning in is.euclid(x.dist): Zero distance(s)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in is.euclid(x.dist2): Zero distance(s)
Warning in is.euclid(x.dist2): Zero distance(s)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in is.euclid(x.dist): Zero distance(s)
Warning in is.euclid(x.dist): Zero distance(s)
Warning in is.euclid(x.dist): Zero distance(s)</code></pre>
</div>
</div>
<p>We can now explore a bit the results. First let’s see how much the different FD indices are correlated between them:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>important.indices <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  resFD<span class="sc">$</span>nbsp, resFD<span class="sc">$</span>FRic, resFD<span class="sc">$</span>FEve, resFD<span class="sc">$</span>FDiv, resFD<span class="sc">$</span>FDis, resFD<span class="sc">$</span>RaoQ</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">species_richness =</span> resFD.nbsp,</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">fric =</span> resFD.FRic,</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">feve.abu =</span> resFD.FEve,</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">fdiv.abu =</span> resFD.FDiv,</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">fdis.abu =</span> resFD.FDis,</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">rao.abu =</span> resFD.RaoQ</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Registered S3 method overwritten by 'GGally':
  method from   
  +.gg   ggplot2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>GGally<span class="sc">::</span><span class="fu">ggpairs</span>(important.indices)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="course_ecodata_4_5_fd_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We generally see that FRic is positively correlated to the number of species, as expected. Of course FDis and Rao give very similar results (they are actually the same index, with only a squaring difference, see Pavoine &amp; Bonsall (<a href="https://doi.org/https://doi.org/10.1111/j.1469-185X.2010.00171.x">2011</a>)). Slight deviations from the perfect linear relationship depends ONLY on the fact that Rao is computed directly from a Gower trait distance, while in FDis the Gower trait distance is first transformed into a PCoA and then the PCoA axes are used to compute the dissimilarities in the multivariate space. In some cases FEve is correlated negatively to FRic, as we discussed in Chapter 5 of the reference text book (see below for more details). We also see that Rao and FDis are increasing when the ‘range’ of traits, i.e.&nbsp;FRic (which is, as we discuss in Chapter 5 of the reference text book, is the size of the Convex Hull when multiple traits are considered, and the range, when only one trait is considered). We also see that both FDis and Rao are not correlated to the number of species. Finally, we also see that FDiv is quite correlated with FDis and Rao.</p>
</section>
<section id="fd-with-fuzzy-coding" class="level3" data-number="2.2.2">
<h3 data-number="2.2.2" class="anchored" data-anchor-id="fd-with-fuzzy-coding"><span class="header-section-number">2.2.2</span> FD with fuzzy coding</h3>
<p>We remind users (see Chapter 3 of the reference textbook, and R material Ch 3) that for computing FD with all traits considered in the ‘spxt’ matrix, which include fuzzy coding (‘LF_xx’ labeled column), we need to complicate a bit more the script. Otherwise the Gower distance used in the dbFD function will ‘understand’ that each of the LF_xx column in the matrix is a different trait. We certainly do not want that, even if it would provide nicer results, as we now want the 4 traits to have the same weight and scale! We can use the approach already introduced for the R material Ch 3, i.e.&nbsp;compute the dissimilarity for each trait separately and then average the dissimilarity across traits:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(traits_spain)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         GrowhtForm LEG      SLA LF_Th LF_G LF_H LF_hCh LF_wCh LF_NP LF_P
Acercamp      shrub   0 2.753661     0    0  0.0    0.0      0     0    1
Achimill       forb   0 2.681022     0    0  0.5    0.5      0     0    0
Aegigeni      grass   0 2.721295     1    0  0.0    0.0      0     0    0
Alchhybr       forb   0 2.944439     0    0  1.0    0.0      0     0    0
Anemhepa       forb   0 2.557227     0    0  1.0    0.0      0     0    0
Anthmont       forb   1 2.602690     0    0  1.0    0.0      0     0    0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>all.dist <span class="ot">&lt;-</span> (<span class="fu">gowdis</span>(traits_spain[<span class="st">"GrowhtForm"</span>]) <span class="sc">+</span> <span class="fu">gowdis</span>(traits_spain[<span class="st">"SLA"</span>]) <span class="sc">+</span> <span class="fu">gowdis</span>(traits_spain[<span class="st">"LEG"</span>]) <span class="sc">+</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>     <span class="fu">gowdis</span>(traits_spain[, <span class="dv">4</span><span class="sc">:</span><span class="dv">10</span>]) <span class="sc">/</span> <span class="fu">max</span>(<span class="fu">gowdis</span>(traits_spain[, <span class="dv">4</span><span class="sc">:</span><span class="dv">10</span>]))) <span class="sc">/</span> <span class="dv">4</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>resFD.alltraits <span class="ot">&lt;-</span> <span class="fu">dbFD</span>(</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  all.dist, <span class="fu">log</span>(<span class="fu">t</span>(species_spain) <span class="sc">+</span> <span class="dv">1</span>), <span class="at">message =</span> <span class="cn">FALSE</span>, <span class="at">calc.CWM =</span> <span class="cn">FALSE</span>, <span class="at">stand.FRic =</span> <span class="cn">TRUE</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in is.euclid(x.dist): Zero distance(s)
Warning in is.euclid(x.dist): Zero distance(s)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in is.euclid(x.dist2): Zero distance(s)
Warning in is.euclid(x.dist2): Zero distance(s)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in is.euclid(x.dist): Zero distance(s)
Warning in is.euclid(x.dist): Zero distance(s)
Warning in is.euclid(x.dist): Zero distance(s)</code></pre>
</div>
</div>
</section>
<section id="saving" class="level3" data-number="2.2.3">
<h3 data-number="2.2.3" class="anchored" data-anchor-id="saving"><span class="header-section-number">2.2.3</span> Saving</h3>
<p>Merge the FD indices in the sites data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> important.indices <span class="sc">%&gt;%</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"id.plot"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id.plot, species_richness, fric, fdis.abu, feve.abu)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>sites_spain <span class="ot">&lt;-</span> sites_spain <span class="sc">%&gt;%</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(data, <span class="at">by =</span> <span class="st">"id.plot"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Save the new sites data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  sites_spain, here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"processed"</span>, <span class="st">"data_processed_sites_spain_4.5.csv"</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plotting" class="level3" data-number="2.2.4">
<h3 data-number="2.2.4" class="anchored" data-anchor-id="plotting"><span class="header-section-number">2.2.4</span> Plotting</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>sites_spain <span class="sc">%&gt;%</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(fric, fdis.abu, feve.abu), <span class="at">names_to =</span> <span class="st">"fd"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">fd =</span> <span class="fu">if_else</span>(</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>      fd <span class="sc">==</span> <span class="st">"fric"</span>, <span class="st">"FRic"</span>,<span class="fu">if_else</span>(</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>        fd <span class="sc">==</span> <span class="st">"fdis.abu"</span>, <span class="st">"FDis"</span>, <span class="fu">if_else</span>(</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>          fd <span class="sc">==</span> <span class="st">"feve.abu"</span>, <span class="st">"FEve"</span>, <span class="st">"Other"</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value)) <span class="sc">+</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> .<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span> fd) <span class="sc">+</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(FD)) <span class="sc">+</span></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>)</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="course_ecodata_4_5_fd_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><a href="#top">Back to top</a></p>
</section>
</section>
<section id="ammer-data" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="ammer-data"><span class="header-section-number">2.3</span> Ammer data</h2>
<p>Now, we calculate functional diversity only for a single trait.</p>
<section id="preparation-1" class="level3" data-number="2.3.1">
<h3 data-number="2.3.1" class="anchored" data-anchor-id="preparation-1"><span class="header-section-number">2.3.1</span> Preparation</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">setdiff</span>(<span class="fu">ls</span>(), <span class="fu">c</span>(<span class="st">"species_ammer"</span>, <span class="st">"species_spain"</span>, <span class="st">"traits_ammer"</span>, <span class="st">"traits_spain"</span>, <span class="st">"sites_spain"</span>, <span class="st">"sites_ammer"</span>)))</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>data_traits <span class="ot">&lt;-</span> traits_ammer <span class="sc">%&gt;%</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(accepted_name, sla_mean, growth_form_2) <span class="sc">%&gt;%</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(sla_mean) <span class="sc">&amp;</span> <span class="sc">!</span>(growth_form_2 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"shrub"</span>, <span class="st">"tree"</span>))) <span class="sc">%&gt;%</span> <span class="co"># remove NAs of SLA and shrubs and trees</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sla_log =</span> <span class="fu">log</span>(sla_mean)) <span class="sc">%&gt;%</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(accepted_name) <span class="sc">%&gt;%</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(accepted_name, sla_log)</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>data_species <span class="ot">&lt;-</span> species_ammer <span class="sc">%&gt;%</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">semi_join</span>(data_traits, <span class="at">by =</span> <span class="st">"accepted_name"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(accepted_name) <span class="sc">%&gt;%</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>accepted_name, <span class="at">names_to =</span> <span class="st">"plot_id"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">"accepted_name"</span>, <span class="at">values_from =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="at">var =</span> <span class="st">"plot_id"</span>)</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>data_traits <span class="ot">&lt;-</span> data_traits <span class="sc">%&gt;%</span></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="st">"accepted_name"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="calculation" class="level3" data-number="2.3.2">
<h3 data-number="2.3.2" class="anchored" data-anchor-id="calculation"><span class="header-section-number">2.3.2</span> Calculation</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>data_abundance <span class="ot">&lt;-</span> FD<span class="sc">::</span><span class="fu">dbFD</span>(</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  data_traits, data_species,</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">calc.CWM =</span> <span class="cn">FALSE</span>, <span class="at">w.abun =</span> <span class="cn">TRUE</span>, <span class="co"># abundance data</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">calc.FRic =</span> <span class="cn">TRUE</span>, <span class="at">stand.FRic =</span> <span class="cn">TRUE</span>, <span class="at">calc.FDiv =</span> <span class="cn">FALSE</span>, <span class="at">corr =</span> <span class="st">"none"</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>FRic: Only one continuous trait or dimension in 'x'. FRic was measured as the range, NOT as the convex hull volume. </code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>data_presence <span class="ot">&lt;-</span> FD<span class="sc">::</span><span class="fu">dbFD</span>(</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  data_traits, data_species,</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">calc.CWM =</span> <span class="cn">FALSE</span>, <span class="at">w.abun =</span> <span class="cn">FALSE</span>, <span class="co"># presence-absence data</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">calc.FRic =</span> <span class="cn">TRUE</span>, <span class="at">stand.FRic =</span> <span class="cn">TRUE</span>, <span class="at">calc.FDiv =</span> <span class="cn">FALSE</span>, <span class="at">corr =</span> <span class="st">"none"</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>FRic: Only one continuous trait or dimension in 'x'. FRic was measured as the range, NOT as the convex hull volume. </code></pre>
</div>
</div>
</section>
<section id="saving-1" class="level3" data-number="2.3.3">
<h3 data-number="2.3.3" class="anchored" data-anchor-id="saving-1"><span class="header-section-number">2.3.3</span> Saving</h3>
<p>Merge the FD indices in the sites data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(data_abundance<span class="sc">$</span>FDis, data_abundance<span class="sc">$</span>FRic, data_abundance<span class="sc">$</span>FEve) <span class="sc">%&gt;%</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"id.plot"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"fdis.abu.sla"</span> <span class="ot">=</span> <span class="st">"data_abundance.FDis"</span>,</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"fric.abu.sla"</span> <span class="ot">=</span> <span class="st">"data_abundance.FRic"</span>,</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"feve.abu.sla"</span> <span class="ot">=</span> <span class="st">"data_abundance.FEve"</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span> <span class="fu">round</span>(.x, <span class="at">digits =</span> <span class="dv">2</span>))</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id.plot, fdis.abu.sla, fric.abu.sla, feve.abu.sla)</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>sla <span class="ot">&lt;-</span> data</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>sites_ammer <span class="ot">&lt;-</span> sites_ammer <span class="sc">%&gt;%</span></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(sla, <span class="at">by =</span> <span class="st">"id.plot"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Save the new sites data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  sites_ammer, here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"processed"</span>, <span class="st">"data_processed_sites_ammer_4.5.csv"</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plotting-1" class="level3" data-number="2.3.4">
<h3 data-number="2.3.4" class="anchored" data-anchor-id="plotting-1"><span class="header-section-number">2.3.4</span> Plotting</h3>
<p>Plot the CWMs of SLA</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>sites_ammer <span class="sc">%&gt;%</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> fdis.abu.sla)) <span class="sc">+</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> .<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(FDis<span class="sc">~</span>SLA)) <span class="sc">+</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>)</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="course_ecodata_4_5_fd_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><a href="#top">Back to top</a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.4.1 (2024-06-14 ucrt)
Platform: x86_64-w64-mingw32/x64
Running under: Windows 11 x64 (build 22631)

Matrix products: default


locale:
[1] LC_COLLATE=German_Germany.utf8  LC_CTYPE=German_Germany.utf8   
[3] LC_MONETARY=German_Germany.utf8 LC_NUMERIC=C                   
[5] LC_TIME=German_Germany.utf8    

time zone: Europe/Berlin
tzcode source: internal

attached base packages:
[1] stats     graphics  grDevices datasets  utils     methods   base     

other attached packages:
 [1] GGally_2.2.1    funspace_0.2.2  FD_1.0-12.3     vegan_2.6-6.1  
 [5] lattice_0.22-6  permute_0.9-7   geometry_0.4.7  ape_5.8        
 [9] ade4_1.7-22     lubridate_1.9.3 forcats_1.0.0   stringr_1.5.1  
[13] dplyr_1.1.4     purrr_1.0.2     readr_2.1.5     tidyr_1.3.1    
[17] tibble_3.2.1    ggplot2_3.5.1   tidyverse_2.0.0 here_1.0.1     

loaded via a namespace (and not attached):
 [1] mnormt_2.1.1            gridExtra_2.3           phangorn_2.11.1        
 [4] rlang_1.1.4             magrittr_2.0.3          compiler_4.4.1         
 [7] mgcv_1.9-1              vctrs_0.6.5             maps_3.4.2             
[10] combinat_0.0-8          quadprog_1.5-8          crayon_1.5.3           
[13] pkgconfig_2.0.3         fastmap_1.2.0           labeling_0.4.3         
[16] magic_1.6-1             utf8_1.2.4              rmarkdown_2.27         
[19] tzdb_0.4.0              pracma_2.4.4            itertools_0.1-3        
[22] bit_4.0.5               xfun_0.45               randomForest_4.7-1.1   
[25] clusterGeneration_1.3.8 jsonlite_1.8.8          parallel_4.4.1         
[28] cluster_2.1.6           R6_2.5.1                RColorBrewer_1.1-3     
[31] stringi_1.8.4           numDeriv_2016.8-1.1     Rcpp_1.0.12            
[34] iterators_1.0.14        knitr_1.48              optimParallel_1.0-2    
[37] Matrix_1.7-0            splines_4.4.1           igraph_2.0.3           
[40] timechange_0.3.0        tidyselect_1.2.1        rstudioapi_0.16.0      
[43] abind_1.4-5             yaml_2.3.9              viridis_0.6.5          
[46] doParallel_1.0.17       codetools_0.2-20        doRNG_1.8.6            
[49] plyr_1.8.9              ks_1.14.2               withr_3.0.0            
[52] coda_0.19-4.1           evaluate_0.24.0         phytools_2.3-0         
[55] ggstats_0.6.0           mclust_6.1.1            pillar_1.9.0           
[58] BiocManager_1.30.25     rngtools_1.5.2          KernSmooth_2.23-24     
[61] renv_1.0.7              foreach_1.5.2           generics_0.1.3         
[64] vroom_1.6.5             rprojroot_2.0.4         hms_1.1.3              
[67] munsell_0.5.1           scales_1.3.0            glue_1.7.0             
[70] scatterplot3d_0.3-44    tools_4.4.1             paran_1.5.3            
[73] mvtnorm_1.2-5           fastmatch_1.1-4         grid_4.4.1             
[76] missForest_1.5          colorspace_2.1-0        nlme_3.1-164           
[79] cli_3.6.3               DEoptim_2.2-8           fansi_1.0.6            
[82] expm_0.999-9            viridisLite_0.4.2       gtable_0.3.5           
[85] digest_0.6.36           farver_2.1.2            htmlwidgets_1.6.4      
[88] htmltools_0.5.8.1       lifecycle_1.0.4         bit64_4.0.5            
[91] MASS_7.3-60.2          </code></pre>
</div>
</div>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>