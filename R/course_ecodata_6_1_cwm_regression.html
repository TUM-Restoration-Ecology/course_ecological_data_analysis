<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.554">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Markus Bauer 1 &amp; Christina Hartung 2  ">
<meta name="dcterms.date" content="2024-09-23">

<title>Analysis of Ecological Data   CWM regression approach</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="course_ecodata_6_1_cwm_regression_files/libs/clipboard/clipboard.min.js"></script>
<script src="course_ecodata_6_1_cwm_regression_files/libs/quarto-html/quarto.js"></script>
<script src="course_ecodata_6_1_cwm_regression_files/libs/quarto-html/popper.min.js"></script>
<script src="course_ecodata_6_1_cwm_regression_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="course_ecodata_6_1_cwm_regression_files/libs/quarto-html/anchor.min.js"></script>
<link href="course_ecodata_6_1_cwm_regression_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="course_ecodata_6_1_cwm_regression_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="course_ecodata_6_1_cwm_regression_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="course_ecodata_6_1_cwm_regression_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="course_ecodata_6_1_cwm_regression_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="2">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#learning-outcomes" id="toc-learning-outcomes" class="nav-link active" data-scroll-target="#learning-outcomes"><span class="header-section-number">1</span> Learning outcomes</a></li>
  <li><a href="#preparation" id="toc-preparation" class="nav-link" data-scroll-target="#preparation"><span class="header-section-number">2</span> Preparation</a>
  <ul>
  <li><a href="#load-libraries-and-functions" id="toc-load-libraries-and-functions" class="nav-link" data-scroll-target="#load-libraries-and-functions"><span class="header-section-number">2.1</span> Load libraries and functions</a></li>
  <li><a href="#load-data" id="toc-load-data" class="nav-link" data-scroll-target="#load-data"><span class="header-section-number">2.2</span> Load data</a></li>
  </ul></li>
  <li><a href="#cwm-regression-community-level" id="toc-cwm-regression-community-level" class="nav-link" data-scroll-target="#cwm-regression-community-level"><span class="header-section-number">3</span> CWM regression (community level)</a>
  <ul>
  <li><a href="#spain-data" id="toc-spain-data" class="nav-link" data-scroll-target="#spain-data"><span class="header-section-number">3.1</span> Spain data</a>
  <ul class="collapse">
  <li><a href="#community-weighted-mean" id="toc-community-weighted-mean" class="nav-link" data-scroll-target="#community-weighted-mean"><span class="header-section-number">3.1.1</span> Community-weighted Mean</a>
  <ul class="collapse">
  <li><a href="#data-exploration-zuur-ieno-step-3" id="toc-data-exploration-zuur-ieno-step-3" class="nav-link" data-scroll-target="#data-exploration-zuur-ieno-step-3"><span class="header-section-number">3.1.1.1</span> Data exploration (Zuur &amp; Ieno Step 3)</a></li>
  <li><a href="#modelling-zuur-ieno-step-6" id="toc-modelling-zuur-ieno-step-6" class="nav-link" data-scroll-target="#modelling-zuur-ieno-step-6"><span class="header-section-number">3.1.1.2</span> Modelling (Zuur &amp; Ieno Step 6)</a></li>
  <li><a href="#model-critique-zuur-ieno-step-7" id="toc-model-critique-zuur-ieno-step-7" class="nav-link" data-scroll-target="#model-critique-zuur-ieno-step-7"><span class="header-section-number">3.1.1.3</span> Model critique (Zuur &amp; Ieno Step 7)</a></li>
  <li><a href="#plot-zuur-ieno-step-9-and-10" id="toc-plot-zuur-ieno-step-9-and-10" class="nav-link" data-scroll-target="#plot-zuur-ieno-step-9-and-10"><span class="header-section-number">3.1.1.4</span> Plot (Zuur &amp; Ieno Step 9 and 10)</a></li>
  </ul></li>
  <li><a href="#functional-diversity" id="toc-functional-diversity" class="nav-link" data-scroll-target="#functional-diversity"><span class="header-section-number">3.1.2</span> Functional diversity</a>
  <ul class="collapse">
  <li><a href="#data-exploration-zuur-ieno-step-3-1" id="toc-data-exploration-zuur-ieno-step-3-1" class="nav-link" data-scroll-target="#data-exploration-zuur-ieno-step-3-1"><span class="header-section-number">3.1.2.1</span> Data exploration (Zuur &amp; Ieno Step 3)</a></li>
  <li><a href="#modelling-zuur-ieno-step-6-1" id="toc-modelling-zuur-ieno-step-6-1" class="nav-link" data-scroll-target="#modelling-zuur-ieno-step-6-1"><span class="header-section-number">3.1.2.2</span> Modelling (Zuur &amp; Ieno Step 6)</a></li>
  <li><a href="#model-critique-zuur-ieno-step-7-1" id="toc-model-critique-zuur-ieno-step-7-1" class="nav-link" data-scroll-target="#model-critique-zuur-ieno-step-7-1"><span class="header-section-number">3.1.2.3</span> Model critique (Zuur &amp; Ieno Step 7)</a></li>
  <li><a href="#plot-zuur-ieno-step-9-and-10-1" id="toc-plot-zuur-ieno-step-9-and-10-1" class="nav-link" data-scroll-target="#plot-zuur-ieno-step-9-and-10-1"><span class="header-section-number">3.1.2.4</span> Plot (Zuur &amp; Ieno Step 9 and 10)</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#forest-understory-vegetation-zelený" id="toc-forest-understory-vegetation-zelený" class="nav-link" data-scroll-target="#forest-understory-vegetation-zelený"><span class="header-section-number">3.2</span> Forest understory vegetation (Zelený)</a>
  <ul class="collapse">
  <li><a href="#preparation-1" id="toc-preparation-1" class="nav-link" data-scroll-target="#preparation-1"><span class="header-section-number">3.2.1</span> Preparation</a></li>
  <li><a href="#calculate-an-analyse-cwm-for-individual-sites" id="toc-calculate-an-analyse-cwm-for-individual-sites" class="nav-link" data-scroll-target="#calculate-an-analyse-cwm-for-individual-sites"><span class="header-section-number">3.2.2</span> Calculate an analyse CWM for individual sites</a>
  <ul class="collapse">
  <li><a href="#modelling-zuur-ieno-step-6-2" id="toc-modelling-zuur-ieno-step-6-2" class="nav-link" data-scroll-target="#modelling-zuur-ieno-step-6-2"><span class="header-section-number">3.2.2.1</span> Modelling (Zuur &amp; Ieno Step 6)</a></li>
  <li><a href="#model-critique-zuur-ieno-step-7-2" id="toc-model-critique-zuur-ieno-step-7-2" class="nav-link" data-scroll-target="#model-critique-zuur-ieno-step-7-2"><span class="header-section-number">3.2.2.2</span> Model critique (Zuur &amp; Ieno Step 7)</a></li>
  <li><a href="#plot-zuur-ieno-step-9" id="toc-plot-zuur-ieno-step-9" class="nav-link" data-scroll-target="#plot-zuur-ieno-step-9"><span class="header-section-number">3.2.2.3</span> Plot (Zuur &amp; Ieno Step 9)</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
  <li><a href="#task" id="toc-task" class="nav-link" data-scroll-target="#task"><span class="header-section-number">4</span> Task</a></li>
  <li><a href="#debate" id="toc-debate" class="nav-link" data-scroll-target="#debate"><span class="header-section-number">5</span> Debate</a>
  <ul>
  <li><a href="#can-we-trust-the-p-value-of-cwm-based-analyses" id="toc-can-we-trust-the-p-value-of-cwm-based-analyses" class="nav-link" data-scroll-target="#can-we-trust-the-p-value-of-cwm-based-analyses"><span class="header-section-number">5.1</span> Can we trust the p-value of CWM-based analyses?</a></li>
  <li><a href="#ltava-data" id="toc-ltava-data" class="nav-link" data-scroll-target="#ltava-data"><span class="header-section-number">5.2</span> Ltava data</a></li>
  <li><a href="#zelený-2018" id="toc-zelený-2018" class="nav-link" data-scroll-target="#zelený-2018"><span class="header-section-number">5.3</span> Zelený (2018)</a></li>
  </ul></li>
  <li><a href="#session-info" id="toc-session-info" class="nav-link" data-scroll-target="#session-info"><span class="header-section-number">6</span> Session info</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Analysis of Ecological Data <br> CWM regression approach</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p><b>Markus Bauer <sup>1</sup> &amp; Christina Hartung <sup>2</sup></b> <br> </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">2024-09-23</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p><sup>1</sup> Technichal University of Munich, TUM School of Life Sciences, Chair of Restoration Ecology, Emil-Ramann-Straße 6, 85354 Freising, Germany</p>
<p><a href="mailto:markus1.bauer@tum.de">markus1.bauer@tum.de</a></p>
<p><img src="https://info.orcid.org/wp-content/uploads/2019/11/orcid_16x16.png" alt="ORCID logo" width="20" height="20"><a href="https://orcid.org/0000-0001-5372-4174" class="uri">https://orcid.org/0000-0001-5372-4174</a></p>
<p><a href="https://scholar.google.de/citations?user=oHhmOkkAAAAJ&amp;hl=de&amp;oi=ao"><img src="https://img.shields.io/badge/Google%20Scholar-4285F4?logo=googlescholar&amp;logoColor=fff&amp;style=for-the-badge.png" class="img-fluid" alt="Google Scholar Badge"></a> <a href="https://github.com/markus1bauer"><img src="https://img.shields.io/badge/github-%23121011.svg?style=for-the-badge&amp;logo=github&amp;logoColor=white" class="img-fluid" alt="GitHub"></a></p>
<p><sup>2</sup> University of Applied Sciences Weihenstephan-Triesdorf, Institute of Ecology and Landscape, Am Hofgarten 1, Building A10, 85354 Freising, Germany</p>
<p><a href="mailto:christina.hartung@hswt.de">christina.hartung@hswt.de</a></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://researchgate.net/profile/Christina-Hartung"><img src="https://img.shields.io/badge/ResearchGate-00CCBB?style=for-the-badge&amp;logo=ResearchGate&amp;logoColor=white.png" class="img-fluid figure-img" alt="ResearchGate"></a></p>
<figcaption>ResearchGate</figcaption>
</figure>
</div>
<p>This tutorial uses Bello et al.&nbsp;(<a href="https://doi.org/10.1017/9781108628426">2021</a>, Ch 5.1.4) and Zelený (<a href="https://www.davidzeleny.net/anadat-r/doku.php/en:cwm_fc_examples#example_3ecological_interpretation_of_the_unconstrained_axes_in_constrained_ordination_using_mean_ellenberg-like_indicator_values">2021</a>).</p>
<section id="learning-outcomes" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Learning outcomes</h1>
<ul>
<li>Knowledge of doing data exploration before modelling</li>
<li>Ability to calculate linear models with indices of functional diversity and environmental variables.</li>
<li>Ability to do a model critique with <code>DHARMa</code></li>
<li>Knowledge that a debate about the reliability of community weighted means exist</li>
</ul>
</section>
<section id="preparation" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Preparation</h1>
<section id="load-libraries-and-functions" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="load-libraries-and-functions"><span class="header-section-number">2.1</span> Load libraries and functions</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork) <span class="co"># combine several ggplots into the same graphic</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DHARMa)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-data" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="load-data"><span class="header-section-number">2.2</span> Load data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>sites_spain <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"processed"</span>, <span class="st">"data_processed_sites_spain_4.5.csv"</span>),</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_names =</span> <span class="cn">TRUE</span>, <span class="at">col_types =</span> <span class="fu">cols</span>(<span class="at">.default =</span> <span class="st">"?"</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>sites_ammer <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"processed"</span>, <span class="st">"data_processed_sites_ammer_4.5.csv"</span>),</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_names =</span> <span class="cn">TRUE</span>, <span class="at">col_types =</span> <span class="fu">cols</span>(<span class="at">.default =</span> <span class="st">"?"</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="fu">url</span>(<span class="st">'https://raw.githubusercontent.com/zdealveindy/anadat-r/master/data/vltava.RData'</span>))</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>species_vltava <span class="ot">&lt;-</span> vltava<span class="sc">$</span>herbs<span class="sc">$</span>spe</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>sites_vltava <span class="ot">&lt;-</span> vltava<span class="sc">$</span>env</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>traits_vltava <span class="ot">&lt;-</span> vltava<span class="sc">$</span>herbs<span class="sc">$</span>traits <span class="sc">%&gt;%</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SLA_sqrt =</span> <span class="fu">sqrt</span>(SLA))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><a href="#top">Back to top</a></p>
</section>
</section>
<section id="cwm-regression-community-level" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> CWM regression (community level)</h1>
<p>Doing linear models needs 10 steps from stating the appropriate question to simulations from the model (Zuur &amp; Ieno <a href="https://doi.org/10.1111/2041-210X.12577">2016</a>, Fig. 1). We do not go into detail of modelling and touch only the points 3 (conduct data exploration), 6 (fit the model), 7 (validate the model), and 9 (create a visual representation). For your theses, it is recommended to go carefully throught the 10 steps.</p>
<section id="spain-data" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="spain-data"><span class="header-section-number">3.1</span> Spain data</h2>
<section id="community-weighted-mean" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1" class="anchored" data-anchor-id="community-weighted-mean"><span class="header-section-number">3.1.1</span> Community-weighted Mean</h3>
<section id="data-exploration-zuur-ieno-step-3" class="level4" data-number="3.1.1.1">
<h4 data-number="3.1.1.1" class="anchored" data-anchor-id="data-exploration-zuur-ieno-step-3"><span class="header-section-number">3.1.1.1</span> Data exploration (Zuur &amp; Ieno Step 3)</h4>
<p>Before starting modelling, you should do a data exploration and keep to a protocol like the popular one of Zuur et al.&nbsp;(<a href="https://doi.org/10.1111/j.2041-210X.2009.00001.x">2010</a>, Fig. 1) and work through the protocol step by step. We do only a very reduced version due to time constraints (here only Zuuer et al.&nbsp;step 6).</p>
<blockquote class="blockquote">
<p>Note: Zuur et al.&nbsp;(<a href="https://doi.org/10.1111/j.2041-210X.2009.00001.x">2010</a>, Fig. 1) steps 2 and 3 are meanwhile part of the model critique after modelling.</p>
</blockquote>
<p>Let’s see if CWM changes along the climatic gradient. For example, let’s explore visually a bit the results before running any analysis, just choosing some of the potential graphs (4 in this case):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> sites_spain <span class="sc">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> moisture.index, <span class="at">y =</span> cwm.abu.sla)) <span class="sc">+</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Moisture Index"</span>, <span class="at">y =</span> <span class="st">"CWM SLA [log mm2/mg]"</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> sites_spain <span class="sc">%&gt;%</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> moisture.index, <span class="at">y =</span> cwm.abu.gf.shrub)) <span class="sc">+</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Moisture Index"</span>, <span class="at">y =</span> <span class="st">"Shrubs [%]"</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> sites_spain <span class="sc">%&gt;%</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> moisture.index, <span class="at">y =</span> cwm.abu.leg<span class="fl">.1</span>)) <span class="sc">+</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Moisture Index"</span>, <span class="at">y =</span> <span class="st">"Legumes [%]"</span>)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> sites_spain <span class="sc">%&gt;%</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> moisture.index, <span class="at">y =</span> cwm.abu.lf.th)) <span class="sc">+</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Moisture Index"</span>, <span class="at">y =</span> <span class="st">"Therophytes [%]"</span>)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>(p1 <span class="sc">+</span> p2) <span class="sc">/</span> (p3 <span class="sc">+</span> p4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="course_ecodata_6_1_cwm_regression_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can already reach some conclusions while looking at these figures. The CWM SLA is increasing with moisture index, likely because of a decrease in shrub species with moisture. If fact, the different growth forms tend to have different SLA.</p>
<p>We can possibly also expect that there is slightly more leguminous species at the intermediate moisture conditions and that the presence of annuals (i.e.&nbsp;therophytes) is slightly higher in the two driest belts [Note that in the second driest site, with moisture index=0.5, there was overall a slightly greater grazing history that in the other sites, hence the generally strange behaviour of the points in these plots, with respect to the general trends].</p>
</section>
<section id="modelling-zuur-ieno-step-6" class="level4" data-number="3.1.1.2">
<h4 data-number="3.1.1.2" class="anchored" data-anchor-id="modelling-zuur-ieno-step-6"><span class="header-section-number">3.1.1.2</span> Modelling (Zuur &amp; Ieno Step 6)</h4>
<p>We can now have a specific look at the statistics and we can also include grazing in the analysis. For example we can use a simple linear model (although maybe a REML, restricted maximum likelihood model, would have been more accurate) where we test the effect of moisture and grazing intensity on the CWM for SLA:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(cwm.abu.sla <span class="sc">~</span> moisture.index <span class="sc">*</span> grazing, <span class="at">data =</span> sites_spain)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(m1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: cwm.abu.sla
                       Df  Sum Sq Mean Sq F value   Pr(&gt;F)    
moisture.index          1 129.548 129.548 70.0102 1.93e-11 ***
grazing                 1   8.028   8.028  4.3386  0.04184 *  
moisture.index:grazing  1   8.634   8.634  4.6658  0.03506 *  
Residuals              56 103.623   1.850                     
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = cwm.abu.sla ~ moisture.index * grazing, data = sites_spain)

Residuals:
    Min      1Q  Median      3Q     Max 
-2.4440 -0.8853 -0.0996  0.6809  5.7820 

Coefficients:
                       Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)              7.0109     0.5273  13.296  &lt; 2e-16 ***
moisture.index           3.1221     0.4483   6.965 3.95e-09 ***
grazing                  1.1980     0.4084   2.933  0.00485 ** 
moisture.index:grazing  -0.7500     0.3472  -2.160  0.03506 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.36 on 56 degrees of freedom
Multiple R-squared:  0.5852,    Adjusted R-squared:  0.563 
F-statistic: 26.34 on 3 and 56 DF,  p-value: 9.317e-11</code></pre>
</div>
</div>
<p>This shows that in general the strongest effect (i.e.&nbsp;‘filter’) on CWM for SLA is by the moisture index but grazing also modifies CWM for SLA, specifically increasing it (likely because of an increase in therophytes and decrease in woody species). However the effect of grazing on CWM for SLA depends on moisture (see the interaction moisture.index:grazing), with a weaker effect in more moist conditions.</p>
<ul>
<li>You have to write down for your results the following: <em>F</em><sub>(3,56)</sub> = 26.3, <em>p</em> = 9.3e-11, <em>R</em><sup>2</sup><sub>adj</sub> = 0.56. Do the same for your dataset later.</li>
</ul>
</section>
<section id="model-critique-zuur-ieno-step-7" class="level4" data-number="3.1.1.3">
<h4 data-number="3.1.1.3" class="anchored" data-anchor-id="model-critique-zuur-ieno-step-7"><span class="header-section-number">3.1.1.3</span> Model critique (Zuur &amp; Ieno Step 7)</h4>
<p>We can not go into details about linear models in this course, but should always present your model critique in the appendix of your thesis. The <code>DHARMa</code> package of Hartig (<a href="https://CRAN.R-project.org/package=DHARMa">2022</a>) helps you with that and is explained by a well prepared <a href="https://cran.r-project.org/web/packages/DHARMa/vignettes/DHARMa.html">vignette</a> (Hartig 2022)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>simulationOutput <span class="ot">&lt;-</span> <span class="fu">simulateResiduals</span>(<span class="at">fittedModel =</span> m1, <span class="at">plot =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(simulationOutput)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="course_ecodata_6_1_cwm_regression_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>You have assumptions for linear models: 1) Normal distribution of residuals and 2) homogeneity of the variances (‘homoscedasticity’). We can see on the left graph that the residuals are normally distributed, because all dots are along the diagonal line. On the right graph, we see that the variances are homogeneous because the dots are equally distributed (“stars-in-the-sky plot”). The DHARMa package helps you with the interpretation, because it highlights problems in red.</p>
<p>Check for collinearity with the variance inflation factor, which should be below 3 or at least 10 (Zuur et al.&nbsp;<a href="https://doi.org/10.1111/j.2041-210X.2009.00001.x">2010</a>)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">vif</span>(m1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>there are higher-order terms (interactions) in this model
consider setting type = 'predictor'; see ?vif</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>        moisture.index                grazing moisture.index:grazing 
              2.500000               3.606067               5.106067 </code></pre>
</div>
</div>
<p>All variables have a VIF &lt; 10.</p>
</section>
<section id="plot-zuur-ieno-step-9-and-10" class="level4" data-number="3.1.1.4">
<h4 data-number="3.1.1.4" class="anchored" data-anchor-id="plot-zuur-ieno-step-9-and-10"><span class="header-section-number">3.1.1.4</span> Plot (Zuur &amp; Ieno Step 9 and 10)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> ggeffects<span class="sc">::</span><span class="fu">ggpredict</span>(m1, <span class="st">"moisture.index"</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>p1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Predicted values of cwm.abu.sla

moisture.index | Predicted |       95% CI
-----------------------------------------
          0.39 |      9.13 |  8.64,  9.63
          0.50 |      9.39 |  8.94,  9.85
          0.72 |      9.92 |  9.53, 10.30
          1.34 |     11.39 | 10.99, 11.79
          2.05 |     13.07 | 12.38, 13.76

Adjusted for:
* grazing = 1.00</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(p1, <span class="at">show_data =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Moisture index"</span>, <span class="at">y =</span> <span class="fu">expression</span>(CWM<span class="sc">~</span>SLA<span class="sc">~</span><span class="st">"["</span><span class="sc">*</span>mm<span class="sc">^</span><span class="dv">2</span><span class="sc">~</span>mg<span class="sc">^-</span><span class="dv">1</span><span class="sc">*</span><span class="st">"]"</span>)) <span class="sc">+</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.line.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.line.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_blank</span>()</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Data points may overlap. Use the `jitter` argument to add some amount of
  random variation to the location of data points and avoid overplotting.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="course_ecodata_6_1_cwm_regression_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Plot the grazing index like the moisture index</li>
</ul>
<p><a href="#top">Back to top</a></p>
</section>
</section>
<section id="functional-diversity" class="level3" data-number="3.1.2">
<h3 data-number="3.1.2" class="anchored" data-anchor-id="functional-diversity"><span class="header-section-number">3.1.2</span> Functional diversity</h3>
<section id="data-exploration-zuur-ieno-step-3-1" class="level4" data-number="3.1.2.1">
<h4 data-number="3.1.2.1" class="anchored" data-anchor-id="data-exploration-zuur-ieno-step-3-1"><span class="header-section-number">3.1.2.1</span> Data exploration (Zuur &amp; Ieno Step 3)</h4>
<p>Having looked which indices are correlated between them allows us to select fewer indices for assessing the relationship between FD and, for example, the moisture index in the different vegetation belts in the NE Spain data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> sites_spain <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> moisture.index, <span class="at">y =</span> species_richness)) <span class="sc">+</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Moisture Index"</span>, <span class="at">y =</span> <span class="st">"Species richness [#]"</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> sites_spain <span class="sc">%&gt;%</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> moisture.index, <span class="at">y =</span> fric)) <span class="sc">+</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Moisture Index"</span>, <span class="at">y =</span> <span class="st">"Functional Richness"</span>)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> sites_spain <span class="sc">%&gt;%</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> moisture.index, <span class="at">y =</span> feve.abu)) <span class="sc">+</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Moisture Index"</span>, <span class="at">y =</span> <span class="st">"Functional Eveness"</span>)</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> sites_spain <span class="sc">%&gt;%</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> moisture.index, <span class="at">y =</span> fdis.abu)) <span class="sc">+</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Moisture Index"</span>, <span class="at">y =</span> <span class="st">"Functional Dispersion"</span>)</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>(p1 <span class="sc">+</span> p2) <span class="sc">/</span> (p3 <span class="sc">+</span> p4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>What we see is that while the number of species is increasing with the moisture index, Functional Richness and Functional Dispersion tend to be maximized at lower or intermediate moisture sites. Hence the mechanisms that maintain species diversity seems not to be the same supporting the functional differentiation between species.</p>
</section>
<section id="modelling-zuur-ieno-step-6-1" class="level4" data-number="3.1.2.2">
<h4 data-number="3.1.2.2" class="anchored" data-anchor-id="modelling-zuur-ieno-step-6-1"><span class="header-section-number">3.1.2.2</span> Modelling (Zuur &amp; Ieno Step 6)</h4>
<p>We can eventually apply different statistical tools to test the relationship with both the moisture index and grazing, as we did in the CWM exercise:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(fdis.abu <span class="sc">~</span> moisture.index <span class="sc">*</span> grazing, <span class="at">data =</span> sites_spain)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = fdis.abu ~ moisture.index * grazing, data = sites_spain)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.043657 -0.013883  0.003567  0.014291  0.038247 

Coefficients:
                        Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)             0.268921   0.008024  33.514  &lt; 2e-16 ***
moisture.index         -0.020885   0.006821  -3.062  0.00338 ** 
grazing                 0.011844   0.006216   1.905  0.06186 .  
moisture.index:grazing -0.004082   0.005284  -0.772  0.44307    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.0207 on 56 degrees of freedom
Multiple R-squared:  0.4149,    Adjusted R-squared:  0.3836 
F-statistic: 13.24 on 3 and 56 DF,  p-value: 1.212e-06</code></pre>
</div>
</div>
<p>The results show a general weak positive effect of grazing on some of the FD components.</p>
</section>
<section id="model-critique-zuur-ieno-step-7-1" class="level4" data-number="3.1.2.3">
<h4 data-number="3.1.2.3" class="anchored" data-anchor-id="model-critique-zuur-ieno-step-7-1"><span class="header-section-number">3.1.2.3</span> Model critique (Zuur &amp; Ieno Step 7)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>simulationOutput <span class="ot">&lt;-</span> <span class="fu">simulateResiduals</span>(<span class="at">fittedModel =</span> m2, <span class="at">plot =</span> <span class="cn">FALSE</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(simulationOutput)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="course_ecodata_6_1_cwm_regression_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">vif</span>(m2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>there are higher-order terms (interactions) in this model
consider setting type = 'predictor'; see ?vif</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>        moisture.index                grazing moisture.index:grazing 
              2.500000               3.606067               5.106067 </code></pre>
</div>
</div>
<p>The model critique is not perfect but ok.</p>
</section>
<section id="plot-zuur-ieno-step-9-and-10-1" class="level4" data-number="3.1.2.4">
<h4 data-number="3.1.2.4" class="anchored" data-anchor-id="plot-zuur-ieno-step-9-and-10-1"><span class="header-section-number">3.1.2.4</span> Plot (Zuur &amp; Ieno Step 9 and 10)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> ggeffects<span class="sc">::</span><span class="fu">ggpredict</span>(m2, <span class="st">"moisture.index"</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Predicted values of fdis.abu

moisture.index | Predicted |     95% CI
---------------------------------------
          0.39 |      0.27 | 0.26, 0.28
          0.50 |      0.27 | 0.26, 0.28
          0.72 |      0.26 | 0.26, 0.27
          1.34 |      0.25 | 0.24, 0.25
          2.05 |      0.23 | 0.22, 0.24

Adjusted for:
* grazing = 1.00</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(p2, <span class="at">show_data =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Moisture index"</span>, <span class="at">y =</span> <span class="fu">expression</span>(FDis<span class="sc">~</span><span class="st">"("</span><span class="sc">*</span>abundance<span class="sc">~</span>data<span class="sc">*</span><span class="st">")"</span>)) <span class="sc">+</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.line.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.line.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_blank</span>()</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Data points may overlap. Use the `jitter` argument to add some amount of
  random variation to the location of data points and avoid overplotting.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="course_ecodata_6_1_cwm_regression_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><a href="#top">Back to top</a></p>
</section>
</section>
</section>
<section id="forest-understory-vegetation-zelený" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="forest-understory-vegetation-zelený"><span class="header-section-number">3.2</span> Forest understory vegetation (Zelený)</h2>
<p>We will use the Vltava dataset to analyse the relationship between the community-weighted mean of one of the leaf traits (specific leaf area, SLA) and one of the environmental variables (light intensity in the understory). The theory predicts that shade-tolerant species will produce leaves with higher SLA (i.e.&nbsp;per gram of dry mass they will produce leaves with the larger area) to optimize the gain from photosynthesis in the dim light of shaded conditions. Let’s use the real data to see whether this works.</p>
<section id="preparation-1" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="preparation-1"><span class="header-section-number">3.2.1</span> Preparation</h3>
<p>First, let’s calculate the community-weighted mean of SLA for individual vegetation plots; since not all species have assigned trait values, we need to first make sure we delete species with missing trait values from both <code>vltava_spe</code> and <code>vltava_traits</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>traits <span class="ot">&lt;-</span> traits_vltava <span class="sc">%&gt;%</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(SLA)) <span class="sc">%&gt;%</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="st">"name"</span>) <span class="sc">%&gt;%</span> <span class="co"># make sure that it is in a certain order</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"name"</span>)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>species <span class="ot">&lt;-</span> species_vltava <span class="sc">%&gt;%</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"plot"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">plot =</span> <span class="fu">paste0</span>(<span class="st">"comm"</span>, plot)) <span class="sc">%&gt;%</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>plot) <span class="sc">%&gt;%</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">"plot"</span>, <span class="at">values_from =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="st">"name"</span>) <span class="sc">%&gt;%</span> <span class="co"># make sure that it is in a certain order</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">semi_join</span>(traits, <span class="at">by =</span> <span class="st">"name"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>name, <span class="at">names_to =</span> <span class="st">"plot"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">"name"</span>, <span class="at">values_from =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="at">var =</span> <span class="st">"plot"</span>)</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>traits <span class="ot">&lt;-</span> traits <span class="sc">%&gt;%</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="at">var =</span> <span class="st">"name"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="calculate-an-analyse-cwm-for-individual-sites" class="level3" data-number="3.2.2">
<h3 data-number="3.2.2" class="anchored" data-anchor-id="calculate-an-analyse-cwm-for-individual-sites"><span class="header-section-number">3.2.2</span> Calculate an analyse CWM for individual sites</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> FD<span class="sc">::</span><span class="fu">dbFD</span>(</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>(traits), species,</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">CWM.type =</span> <span class="st">"all"</span>,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">corr =</span> <span class="st">"cailliez"</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Species x species distance matrix was not Euclidean. Cailliez correction was applied. 
FRic: Dimensionality reduction was required. The last 195 PCoA axes (out of 199 in total) were removed. 
FRic: Quality of the reduced-space representation (based on corrected distance matrix) = 0.1297199 </code></pre>
</div>
</div>
<section id="modelling-zuur-ieno-step-6-2" class="level4" data-number="3.2.2.1">
<h4 data-number="3.2.2.1" class="anchored" data-anchor-id="modelling-zuur-ieno-step-6-2"><span class="header-section-number">3.2.2.1</span> Modelling (Zuur &amp; Ieno Step 6)</h4>
<p>Calculate a linear model regression of CWM SLA on the canopy cover:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>m3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(data<span class="sc">$</span>CWM<span class="sc">$</span>SLA <span class="sc">~</span> sites_vltava<span class="sc">$</span>COVERE32)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(m3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: data$CWM$SLA
                      Df  Sum Sq Mean Sq F value  Pr(&gt;F)    
sites_vltava$COVERE32  1  506.51  506.51  22.843 6.4e-06 ***
Residuals             95 2106.51   22.17                    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section>
<section id="model-critique-zuur-ieno-step-7-2" class="level4" data-number="3.2.2.2">
<h4 data-number="3.2.2.2" class="anchored" data-anchor-id="model-critique-zuur-ieno-step-7-2"><span class="header-section-number">3.2.2.2</span> Model critique (Zuur &amp; Ieno Step 7)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>simulationOutput <span class="ot">&lt;-</span> <span class="fu">simulateResiduals</span>(<span class="at">fittedModel =</span> m2, <span class="at">plot =</span> <span class="cn">FALSE</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(simulationOutput)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="course_ecodata_6_1_cwm_regression_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">vif</span>(m2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>there are higher-order terms (interactions) in this model
consider setting type = 'predictor'; see ?vif</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>        moisture.index                grazing moisture.index:grazing 
              2.500000               3.606067               5.106067 </code></pre>
</div>
</div>
</section>
<section id="plot-zuur-ieno-step-9" class="level4" data-number="3.2.2.3">
<h4 data-number="3.2.2.3" class="anchored" data-anchor-id="plot-zuur-ieno-step-9"><span class="header-section-number">3.2.2.3</span> Plot (Zuur &amp; Ieno Step 9)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> sites_vltava, <span class="fu">aes</span>(<span class="at">y =</span> data<span class="sc">$</span>CWM<span class="sc">$</span>SLA, <span class="at">x =</span> sites_vltava<span class="sc">$</span>COVERE32)) <span class="sc">+</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Canopy cover [%]"</span>, <span class="at">y =</span> <span class="st">"CWM SLA"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Use of `sites_vltava$COVERE32` is discouraged.
ℹ Use `COVERE32` instead.
Use of `sites_vltava$COVERE32` is discouraged.
ℹ Use `COVERE32` instead.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="course_ecodata_6_1_cwm_regression_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>So far it goes well - as we see, the relationship is positive and statistically clear (<em>P</em> &lt; 0.001). The kind of plot is a type which you can use for data exploration and not for a real final plot.</p>
<blockquote class="blockquote">
<p>Plot only a line in your graph it is statistically clear. If not plot none or a dashed line</p>
</blockquote>
<p><a href="#top">Back to top</a></p>
</section>
</section>
</section>
</section>
<section id="task" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Task</h1>
<ul>
<li>Calculate linear models for some of your CWMs and FD indices.</li>
</ul>
</section>
<section id="debate" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Debate</h1>
<p>(further reading, optional)</p>
<section id="can-we-trust-the-p-value-of-cwm-based-analyses" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="can-we-trust-the-p-value-of-cwm-based-analyses"><span class="header-section-number">5.1</span> Can we trust the p-value of CWM-based analyses?</h2>
<p>In the reference text book, in Chapter 5, we provide an extensive discussion on some potential problems using analyses with CWM. Some authors have suggested that CWM should not be used because the analyses using CWM provide too optimistic p-values. As summarized by David Zelený and in the reference text book (Zelený <a href="https://doi.org/10.1111/jvs.12688">2018</a>), we think that the question is not if we can trust the the p-value of CWM-based analyses but rather which type of questions are asked. If we are interested in observing changes in CWM along gradient, whatever are the causes, then analyses on CWM are robust and interesting. If the question is, for example, if the MAJORITY of species in drier habitats have given traits, then a different type of analyses should be done, basically the analyses at the species level presented in Chapter 3 and in the R material Ch 2.</p>
<p>Let’s now focus on the suggestion by David Zelený (<a href="https://doi.org/10.1111/jvs.12688">2018</a>) on how to run a conservative tests to evaluate the significance of environmental factors on CWM values. The suggestion by Zelený can be summarized as to run randomizations tests and, basically, verify if the R^2 of a given model (for example those obtained in the previous section) is higher than expected by chance. Randomizations can be done in different ways, but we suggest that a simple and effective one is by simply shuffling species names in the trait matrix.</p>
<p><a href="#top">Back to top</a></p>
</section>
<section id="ltava-data" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="ltava-data"><span class="header-section-number">5.2</span> Ltava data</h2>
<p>The problem is that even with random traits, we have actually a rather good chance to obtain a significant relationship between CWM and environmental variables. Let’s see it on the same data, by permuting the SLA values among species, calculating CWM from these randomized trait values, and testing the regression of this randomized CWM on the original environmental variable:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># P_rand &lt;- replicate(1000, expr = {</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   SLA_rand &lt;- sample(SLA_1)</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   CWM_SLA_rand &lt;-  apply(com_1, 1, FUN = function(x) sum(x*SLA_rand)/sum(x))</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   LM_rand_col &lt;- lm(CWM_SLA_rand ~ cover)</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   P_value &lt;- anova(LM_rand_col)$`Pr(&gt;F)`[1]</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   return(P_value)</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="co"># })</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="co"># sum(P_rand &lt; 0.05) </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Surprisingly, around 280 out of 1000 regressions are significant - but if the test has a correct Type I error rate, it should be around 5% = 50 (out of 1000) significant results. Clearly, the standard parametric test has an inflated Type I error rate.</p>
<p>The solution to this problem is to apply the “max” permutation test, which combines results of row- and column-based permutation, and chooses the higher (less significant) P-value. The “max” test can be calculated by package <code>weimea</code> (name derived from the community weighted mean), using the function <code>test_cwm</code>.</p>
<p>Note that <code>weimea</code> contains also the function <code>cwm</code>, which offers quick calculation of CWM values from species composition and trait matrix, and can treat the missing values - no need to remove them first. Still, the number of species in the species composition matrix (columns) and species trait matrix (rows) must be identical, and the order of species must be also the same - <code>cwm</code> function does not check for this.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># library (weimea)</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># CWM_SLA_w &lt;- weimea::cwm(com = com, traits = SLA)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The variable <code>CWM_SLA_w</code> is like a data frame with calculated CWM, but is much more than that; the object is of the class <code>cwm</code>, and contains also the original data used for calculation of CWM (that is why I used a different name of the object from <code>SLA_CWM</code> calculated above, even though the calculated values are identical - you may check if you want). It can thus be used directly for testing the regression of CWM and environmental variable, using the function <code>test_cwm</code>; you need to also select the method of relating CWM to environmental variables (currently only <code>lm</code> for linear model regression, and <code>cor</code> for Pearson’s correlation, are available):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># CWM_cover &lt;- weimea::test_cwm(cwm = CWM_SLA_w, env = cover, method = 'lm', test = 'all')</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="co"># CWM_cover</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The test output is longish. Important is the P_max value in the end, which is significant (P = 0.02). You can also see how it was calculated, because the function returns P-values of both row- (<code>P_row</code>) and column-based (<code>P_col</code>) permutation test. <code>P_par</code> is the result of the parametric F-test, identical to the result of <code>anova</code> function above.</p>
<p>The package <code>weimea</code> also offers dedicated function to plot the results of the regression:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(CWM_cover)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The conclusion is that the relationship between CWM of SLA for herb species in the forest understory and the light availability is significant even if tested by the “max” test. This offers a strong suggestion that stronger light may filter the species into the community with lower SLA leaves.</p>
<p><a href="#top">Back to top</a></p>
</section>
<section id="zelený-2018" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="zelený-2018"><span class="header-section-number">5.3</span> Zelený (<a href="https://doi.org/10.1111/jvs.12688">2018</a>)</h2>
<p>The recent paper by Peres-Neto, Dray, and ter Braak (<a href="https://doi.org/10.1111/ecog.02302">2017</a>), focused on the CWM approach, revealed several surprising facts. First, and perhaps the most important finding, is that standard plot-level tests analysing CWM–sample attributes relationship have inflated Type I error rate, returning more optimistic results than is warranted by the data. “Standard tests”, in the meaning used here, include plot-level parametric tests such as the t-test for correlation and F-test for regression or ANOVA, or permutation tests randomizing sample attributes (equivalent to randomizing rows in the species composition matrix). Second, CWM correlation has relatively poor statistical properties, because the correlation coefficient is highly variable and can become rather high even in the case of random species attributes. Third, the CWM approach is numerically related to the seemingly different fourth-corner problem (Legendre et al.&nbsp;<a href="https://doi.org/10.1890/0012-9658(1997)078%5B0547:RBTHST%5D2.0.CO;2">1997</a>), which relates species attributes and sample attributes via the species composition matrix without explicitly calculating the weighted means of species attributes. Fourth, the ‘max test’ (Cormont et al.&nbsp;2011), which solves the problem of inflated Type I error rate in the fourth-corner approach (ter Braak et al.&nbsp;2012), does the same in the CWM approach. The max test undertakes two independent permutation tests, one testing the species attributes–species composition link and the other testing the sample attributes–species composition link, and chooses the higher p-value as a result. In conclusion, Peres-Neto et al.&nbsp;(<a href="https://doi.org/10.1111/ecog.02302">2017</a>) suggested replacing the CWM approach with the more efficient fourth-corner approach.</p>
<p>The findings of Peres-Neto et al.&nbsp;(<a href="https://doi.org/10.1111/ecog.02302">2017</a>) will undoubtedly cause a revolution in the analysis of trait–environment, and generally, species attributes–sample attributes relationships. It is quite relevant to expect that scientific literature using CWM approach with standard tests is flooded with overly optimistic studies reporting significant relationships between various species and sample attributes, which in fact are merely analytical artefacts. However, the use of the CWM approach has a long tradition in ecology, and calculating the CWM of species attributes and relating them to sample attributes is quite often practical or required by theory. Many studies defining our current empirical knowledge about the trait–environment relationship or the efficiency of Ellenberg-type indicator values have been published, and many studies will use this approach in the future. What can be done about that? Moreover, if the CWM approach is used in future studies, is it always necessary to replace the standard tests with the max solution?</p>
<p>The use of CWM approach as a plot-level analysis is fully justified in cases where the question is explicitly focused on relating the community-level values of species attributes to environment, such as the CWM of traits or mean Ellenberg species indicator values. The CWM approach with a standard (row-based) test returns a correct Type I error rate only when the tested hypothesis assumes that species composition is linked to species attributes and one is testing whether the species composition is linked to sample attributes. If the plot-level analysis is not required, alternative methods may be more powerful namely fourth corner or SNC approaches.</p>
<p><a href="#top">Back to top</a></p>
</section>
</section>
<section id="session-info" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Session info</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.4.1 (2024-06-14 ucrt)
Platform: x86_64-w64-mingw32/x64
Running under: Windows 11 x64 (build 22631)

Matrix products: default


locale:
[1] LC_COLLATE=German_Germany.utf8  LC_CTYPE=German_Germany.utf8   
[3] LC_MONETARY=German_Germany.utf8 LC_NUMERIC=C                   
[5] LC_TIME=German_Germany.utf8    

time zone: Europe/Berlin
tzcode source: internal

attached base packages:
[1] stats     graphics  grDevices datasets  utils     methods   base     

other attached packages:
 [1] DHARMa_0.4.6    patchwork_1.2.0 lubridate_1.9.3 forcats_1.0.0  
 [5] stringr_1.5.1   dplyr_1.1.4     purrr_1.0.2     readr_2.1.5    
 [9] tidyr_1.3.1     tibble_3.2.1    ggplot2_3.5.1   tidyverse_2.0.0
[13] here_1.0.1     

loaded via a namespace (and not attached):
 [1] ade4_1.7-22         tidyselect_1.2.1    farver_2.1.2       
 [4] fastmap_1.2.0       promises_1.3.0      digest_0.6.36      
 [7] timechange_0.3.0    mime_0.12           lifecycle_1.0.4    
[10] cluster_2.1.6       magrittr_2.0.3      compiler_4.4.1     
[13] rlang_1.1.4         tools_4.4.1         utf8_1.2.4         
[16] yaml_2.3.9          geometry_0.4.7      knitr_1.48         
[19] labeling_0.4.3      htmlwidgets_1.6.4   bit_4.0.5          
[22] plyr_1.8.9          gap.datasets_0.0.6  abind_1.4-5        
[25] withr_3.0.0         datawizard_0.12.3   grid_4.4.1         
[28] fansi_1.0.6         xtable_1.8-4        colorspace_2.1-0   
[31] scales_1.3.0        iterators_1.0.14    MASS_7.3-60.2      
[34] insight_0.20.4      cli_3.6.3           vegan_2.6-6.1      
[37] rmarkdown_2.27      crayon_1.5.3        generics_0.1.3     
[40] rstudioapi_0.16.0   tzdb_0.4.0          magic_1.6-1        
[43] ape_5.8             minqa_1.2.7         splines_4.4.1      
[46] parallel_4.4.1      BiocManager_1.30.25 vctrs_0.6.5        
[49] boot_1.3-30         Matrix_1.7-0        jsonlite_1.8.8     
[52] carData_3.0-5       car_3.1-2           hms_1.1.3          
[55] bit64_4.0.5         qgam_1.3.4          foreach_1.5.2      
[58] gap_1.6             glue_1.7.0          nloptr_2.1.1       
[61] codetools_0.2-20    stringi_1.8.4       gtable_0.3.5       
[64] later_1.3.2         ggeffects_1.7.1     lme4_1.1-35.5      
[67] munsell_0.5.1       pillar_1.9.0        htmltools_0.5.8.1  
[70] R6_2.5.1            Rdpack_2.6.1        doParallel_1.0.17  
[73] rprojroot_2.0.4     vroom_1.6.5         evaluate_0.24.0    
[76] shiny_1.9.1         lattice_0.22-6      haven_2.5.4        
[79] rbibutils_2.2.16    FD_1.0-12.3         renv_1.0.7         
[82] httpuv_1.6.15       Rcpp_1.0.12         permute_0.9-7      
[85] nlme_3.1-164        mgcv_1.9-1          xfun_0.45          
[88] pkgconfig_2.0.3    </code></pre>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>